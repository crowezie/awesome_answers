<h1><%= @question.title %></h1>
<hr>
<p><%= @question.body %></p>
<p>View Count: <%= @question.view_count %></p>
<p>Category: <%= @question.category_name %></p>
<p>Tags: <%= @question.tags.map {|x| x.name}.join(", ") %></p>

<p>Created by <%= @question.user_name %> on
                <%= formatted_date(@question.created_at) %></p>
<%# this link to the edit page of the question that shows a form to edit the values already saved %>
<% if can? :edit, @question %>
  <%= link_to "Edit", edit_question_path(@question), class: "btn btn-info" %>
<% end %>
<% if can? :destroy, @question %>
  <%= link_to "Delete", question_path(@question), method: :delete, data: {confirm: "Are you sure?"}, class: "btn btn-danger" %>
<% end %>

<%= link_to (@question.locked ? "Lock" : "Un-lock"),
            question_path(@question, {question: {locked: !@question.locked}}),
            class: "btn btn-warning", method: :patch %>
<% if user_signed_in? %>
  <% if current_user.liked_question?(@question) %>
    <%= link_to fa_icon("thumbs-up"),
                question_like_path(@question, @question.like_for(current_user)),
                class: "big-icon", title: "Un-Like", method: :delete %>
  <% else %>
    <%= link_to fa_icon("thumbs-o-up"), question_likes_path(@question),
                  class: "big-icon", method: :post %>
  <% end %>
<% end %>
(<%= @question.likes.count %>)

<% if user_signed_in? %>
  <% if current_user.favorited_question?(@question) %>
    <%= link_to fa_icon("star"),
                question_favorite_path(@question, @question.favorite_for(current_user)),
                class: "big-icon", title: "Un-favorite", method: :delete %>
  <% else %>
    <%= link_to fa_icon("star-o"), question_favorites_path(@question),
                  class: "big-icon", method: :post %>
  <% end %>
<% end %>
(<%= @question.favorites.count %>)

<% if user_signed_in? %>

<% if current_user_vote.nil? %>
<%= link_to fa_icon("chevron-up"), question_votes_path(@question, {vote: {up: true}}), class: "big-icon", method: :post %>
<%= link_to fa_icon("chevron-down"), question_votes_path(@question, {vote: {up: false}}), class: "big-icon", method: :post  %>
<% elsif current_user_vote.up? %>
 <%# if user has voted up  %>
 <%= link_to fa_icon("chevron-circle-up"), question_vote_path(@question, current_user_vote), class: "big-icon", method: :delete %>
 <%= link_to fa_icon("chevron-down"), question_vote_path(@question, current_user_vote, {vote: {up: false}}), method: :patch, class: "big-icon" %>
<% else %>
 <%# if user has voted down  %>
 <%= link_to fa_icon("chevron-up"), question_vote_path(@question, current_user_vote, {vote: {up: true}}), class: "big-icon",  method: :patch %>
 <%= link_to fa_icon("chevron-circle-down"), question_vote_path(@question, current_user_vote), method: :delete, class: "big-icon" %>

<% end %>
<% end %>

<%= @question.votes_count%>


<h2 class="sub">New Answer</h2>
<% if @answer.errors.any? %>
<ul>
  <% @answer.errors.full_messages.each do |msg| %>
  <li><%= msg %></li>
  <% end %>
</ul>
<% end %>
<div class="container">
  <%# @answer (not persisted) -> URL: answers_path (CREATE)  %>
  <%# @answer (persisted (in DB())) -> URL: answers_path(@answer) (Update)  %>

  <%#= form_for @answer, url: question_answers_path(@question), html: {class:"form-horizontal"} do |f| %>
  <%# Same as %>
  <%= form_for [@question, @answer], html: {class:"form-horizontal"} do |f| %>
  <div class="form-group">
    <%= f.label :body %>
    <%= f.text_area :body, class: "form-control" %>
  </div>
  <div class="form-group">
    <%= f.submit "Create Answer", class: "btn btn-primary" %>
  </div>
  <% end %>
</div>

<h2 class="sub">Answers</h2>
<% @question.answers.each do |ans| %>
<div class="well">
<div class="well" id="<%= dom_id(ans) %>">
  <%= ans.body %>
  <%= link_to "Delete", question_answer_path(@question, ans), method: :delete, data: {confirm: "Are you sure?"}, class: "btn btn-sm btn-danger" %>
  <p>Created by: <%= ans.user_name %></p> on <%= formatted_date(ans.created_at) %>
  <h3>Add a Comment</h3>
  <%= form_for [ans, Comment.new], html: {class:"form-horizontal"} do |f|%>
  <div class="form-group">
    <%= f.text_area :body, placeholder: "add comment here..", class: "form-control" %>
  </div>
  <div class="form-group">
    <%= f.submit "Create Comment", class: "btn btn-primary" %>
  </div>
  <% end %>
  <h2 class="sub">Comments</h2>
  <% ans.comments.each do |com| %>
  <div class="well">
    <p>
      <strong>Comment:</strong>
      <%= com.body %>
    </p>
  </div>
  <% end %>
</div>
<% end %>
